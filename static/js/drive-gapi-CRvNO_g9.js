var d=Object.defineProperty;var p=(a,e,t)=>e in a?d(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var n=(a,e,t)=>p(a,typeof e!="symbol"?e+"":e,t);import{d as l}from"./index-DbHcLYuo.js";import{b1 as c}from"./index-CCiqnY4g.js";const h="AIzaSyC-ysFtHg8WdeTMtndJEOx8LaFnm0CWUmk",f="235324461758-n9qs0f3kec5e8q8t2almq6edn0cjh704.apps.googleusercontent.com";class y{constructor(e){n(this,"googleConnect",c("connectsStore.google"));n(this,"DISCOVERY_DOC","https://www.googleapis.com/discovery/v1/apis/drive/v3/rest");n(this,"SCOPES",["https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.metadata.readonly"]);n(this,"DEFAULTS",{PAGE_SIZE:20,FOLDER_ROOT:"root",FIELDS_FOLDER:"id,name,mimeType,parents",FIELDS_FILE:"id,name,mimeType,size,parents,imageMediaMetadata,webViewLink,webContentLink,thumbnailLink"});n(this,"MIME_TYPE",{google:"application/vnd.google-apps.",audio:"application/vnd.google-apps.audio",docs:"application/vnd.google-apps.document","3rd_party_shortcut":"application/vnd.google-apps.drive-sdk",drawing:"application/vnd.google-apps.drawing",file:"application/vnd.google-apps.file",folder:"application/vnd.google-apps.folder",forms:"application/vnd.google-apps.form",table:"application/vnd.google-apps.fusiontable",Jamboard:"application/vnd.google-apps.jam",map:"application/vnd.google-apps.map",photo:"application/vnd.google-apps.photo",slide:"application/vnd.google-apps.presentation",script:"application/vnd.google-apps.script",shortcut:"application/vnd.google-apps.shortcut",site:"application/vnd.google-apps.site",sheets:"application/vnd.google-apps.spreadsheet",unknown:"application/vnd.google-apps.unknown",video:"application/vnd.google-apps.video",image:"image"});n(this,"getThumbnail",e=>{console.log(e);for(const t of e)t.src=`https://drive.google.com/thumbnail?id=${t.id}`,t.direct=`https://drive.google.com/thumbnail?id=${t.id}`});n(this,"CheckClient",async()=>new Promise(async(e,t)=>{const i={min:0,max:6e3};for(;(!window.gapi.client||!window.gapi.client.drive)&&i.min<i.max;)await l(100),i.min+=10;await l(1e3),window.gapi.client&&window.gapi.client.drive?e(!0):t("timeout")}));n(this,"GetFolder",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={spaces:"drive",supportsAllDrives:!0,supportsTeamDrives:!0,q:`trashed=${e.trashed} and mimeType='${this.MIME_TYPE.folder}'`,pageSize:1,fields:`files(${e.fields||this.DEFAULTS.FIELDS_FOLDER})`};i.q+=` and name='${e.name}'`,e.parents&&(i.q+=` and '${e.parents}' in parents`);const o=await window.gapi.client.drive.files.list(i);return o.result.files&&o.result.files.length?o.result.files[0]:null}catch(t){throw new Error(t)}});n(this,"GetFolders",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");let i=[];const o={spaces:"drive",supportsAllDrives:!0,supportsTeamDrives:!0,q:`trashed=${e.trashed} and mimeType='${this.MIME_TYPE.folder}'`,pageSize:e.pageSize||this.DEFAULTS.PAGE_SIZE,fields:`files(${e.fields||this.DEFAULTS.FIELDS_FOLDER})`};if(e.folderId)o.q+=` and '${e.folderId}' in parents`;else if(e.parents)o.q+=` and '${e.parents}' in parents`,i.push({id:e.parents,name:"Root",parents:null,mimeType:this.MIME_TYPE.folder,children:[]});else{const r=await this.GetFolder({name:e.rootFolder,pageSize:e.pageSize,trashed:e.trashed,fields:null,parents:null});r?(o.q+=` and '${r.id}' in parents`,i.push({id:r.id,name:"Root",parents:null,mimeType:this.MIME_TYPE.folder,children:[]})):this.DEFAULTS.FOLDER_ROOT?(o.q+=` and '${this.DEFAULTS.FOLDER_ROOT}' in parents`,i.push({id:this.DEFAULTS.FOLDER_ROOT,name:"Root",parents:null,mimeType:this.MIME_TYPE.folder,children:[]})):i.push({id:"drive",name:"Drive",parents:null,mimeType:this.MIME_TYPE.folder,children:[]})}const s=await window.gapi.client.drive.files.list(o);return s.result.files&&(i.length&&i[0].children?i[0].children=s.result.files:i=i.concat(s.result.files)),i}catch(t){throw new Error(t)}});n(this,"GetFileById",async e=>{try{if(!e||!e.id)throw new Error("404");if(e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={spaces:"drive",supportsAllDrives:!0,fileId:e.id,q:`trashed=${e.trashed}`,fields:e.fields||this.DEFAULTS.FIELDS_FILE};return(await window.gapi.client.drive.files.get(i)).result}catch(t){throw new Error(t)}});n(this,"GetFilesById",async e=>{try{const t=[];for(const i of e.ids){e.id=i;const o=await this.GetFileById(e);o&&t.push(o),l(100)}return t}catch(t){throw new Error(t)}});n(this,"GetFileByName",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={spaces:"drive",supportsAllDrives:!0,supportsTeamDrives:!0,q:`trashed=${e.trashed} and mimeType != '${this.MIME_TYPE.folder}'`,pageSize:1,fields:`nextPageToken, files(${e.fields||this.DEFAULTS.FIELDS_FILE})`};i.q+=` and name='${e.name}'`,i.q+=` and '${e.parents||this.DEFAULTS.FOLDER_ROOT}' in parents`,e.mimeType&&(i.q+=` and mimeType contains '${e.mimeType}'`);const o=await window.gapi.client.drive.files.list(i);return o.result.files&&o.result.files.length?o.result.files[0]:null}catch(t){throw new Error(t)}});n(this,"GetFiles",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={spaces:"drive",supportsAllDrives:!0,supportsTeamDrives:!0,q:`trashed=${e.trashed}`,pageToken:e.nextPageToken||null,pageSize:e.pageSize||this.DEFAULTS.PAGE_SIZE,fields:`nextPageToken, files(${e.fields||this.DEFAULTS.FIELDS_FILE})`};if((e.isFolder===void 0||!e.isFolder)&&(i.q+=` and mimeType!='${this.MIME_TYPE.folder}'`),e.mimeType&&(i.q+=` and mimeType contains '${e.mimeType}'`),e.folderId)i.q+=` and '${e.folderId||this.DEFAULTS.FOLDER_ROOT}' in parents`;else if(e.folderName){const s=await this.GetFolder({name:e.folderName,trashed:e.trashed,fields:null,pageSize:null,parents:null});s&&(i.q+=` and '${s.id}' in parents`)}const o=await window.gapi.client.drive.files.list(i);return e.mimeType==this.MIME_TYPE.image&&this.getThumbnail(o.result.files),o.result}catch(t){throw new Error(t)}});n(this,"CreateFolder",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={name:e.name,parents:e.parents?[e.parents]:[this.DEFAULTS.FOLDER_ROOT],mimeType:this.MIME_TYPE.folder},o=await window.gapi.client.drive.files.create(i);return o.result&&(o.result.parents=i.parents),o.result}catch(t){return console.log(t),null}});n(this,"UploadFile",async(e,t)=>{try{if(!e)throw new Error("noExist");if(t||(t={}),t.trashed=t.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const o={name:e.name,mimeType:e.type,parents:t.parents?[t.parents]:[this.DEFAULTS.FOLDER_ROOT],fields:t.fields||this.DEFAULTS.FIELDS_FILE},s=new FormData;return s.append("metadata",new Blob([JSON.stringify(o)],{type:"application/json"})),s.append("file",e),await(await fetch(`https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=${t.fields||this.DEFAULTS.FIELDS_FILE}`,{method:"POST",headers:new Headers({Authorization:`Bearer ${gapi.auth.getToken().access_token}`}),body:s})).json()}catch(i){console.log(i)}});n(this,"UploadFiles",async(e,t)=>{try{const i=[];for(const o of e){const s=await this.UploadFile(o,t);this.getThumbnail(s),i.push(s)}return i}catch(i){console.log(i)}});n(this,"UpdateFile",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={}}catch(t){console.log(t)}});n(this,"UpdateTrashFile",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={}}catch(t){console.log(t)}});n(this,"DeleteFile",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={}}catch(t){console.log(t)}});n(this,"EmptyTrash",async e=>{try{if(e||(e={}),e.trashed=e.trashed||!1,!await this.CheckClient())throw new Error("Error Client");const i={}}catch(t){console.log(t)}});this.DEFAULTS.FOLDER_ROOT=e&&e.root?e.root:this.DEFAULTS.FOLDER_ROOT,this.initialize()}initialize(){return(async()=>(window.gapi.load("client",{callback:async e=>{await window.gapi.client.init({apiKey:h,clientId:f,scope:this.SCOPES.join(" "),discoveryDocs:[this.DISCOVERY_DOC]}).then(()=>{this.googleConnect&&this.googleConnect.access_token&&window.gapi.client.setToken({access_token:this.googleConnect.access_token})})}}),this))()}}export{y as G};
