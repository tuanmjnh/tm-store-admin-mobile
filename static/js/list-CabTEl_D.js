import{aq as X,ar as h,d as Y,r as p,$ as u,c as N,b as i,w as d,e as s,i as x,F as V,P as Z,o as y,f as tt,g as S,a as et,t as P,s as at,K as L,q as st,C as nt,L as lt,T as ot,j as it}from"./index-CCiqnY4g.js";import{A as rt}from"./index-B5j9-yk4.js";import{D as ct,a as ut}from"./index-BMD1pfGu.js";import"./index-df1euzin.js";import{S as dt}from"./index-CV8Z38v6.js";import{P as pt,T as ft,S as mt}from"./index-LNpVP83O.js";import{_ as _t}from"./tabBarView.vue_vue_type_script_setup_true_lang-Dr-UnG8l.js";import{d as ht}from"./index-DbHcLYuo.js";import{B as gt}from"./index-KPzygAO1.js";const R={code:null,groups:null,title:null,desc:null,content:null,url:null,author:null,date:null,pins:null,tags:null,attr:null,meta:null,images:null,attach:null,startAt:null,endAt:null,order:1,flag:1,created:{at:null,by:null,ip:null}},g="news",vt=X("newsStore",{persist:!1,state:()=>({items:[],item:JSON.parse(JSON.stringify(R))}),getters:{},actions:{async getAll(a){try{const t=await h.axiosInstance.get(`/${g}/all`,{params:a});return this.all=t.data,t}catch(t){throw t}},async getItems(a){try{const t=await h.axiosInstance.get(`/${g}`,{params:a});return this.items=t.data,this.rowsNumber=t.rowsNumber,t}catch(t){throw t}},async getItem(a){try{const t=await h.axiosInstance.get(`/${g}/${a.id}`,{params:a});return this.item=t.data,t}catch(t){throw t}},async create(a){try{return await h.axiosInstance.post(`/${g}`,a)}catch(t){throw t}},async update(a){try{return await h.axiosInstance.put(`/${g}`,a)}catch(t){throw t}},async updateFlag(a){try{return await h.axiosInstance.patch(`/${g}`,a)}catch(t){throw t}},async setItem(a){this.item=a?{...a}:JSON.parse(JSON.stringify(R))},async addItems(a,t){try{t?Array.isArray(a)?this.items.concat(a):this.items.push(a):Array.isArray(a)?this.items.concat(a):this.items.push(a)}catch(e){throw e}},async updateItems(a,t){try{if(Array.isArray(a))a.forEach(e=>{if(t){const o=t.findIndex(r=>r._id===e._id);o>-1&&t.splice(o,1,e)}else{const o=this.items.findIndex(r=>r._id===e._id);o>-1&&this.items.splice(o,1,e)}});else{const e=this.items.findIndex(o=>o._id===a._id);e>-1&&this.items.splice(e,1,a)}}catch(e){throw e}},async removeItems(a,t){try{if(Array.isArray(a))a.forEach(e=>{if(t){const o=t.findIndex(r=>r._id===e);o>-1&&t.splice(o,1)}else{const o=this.items.findIndex(r=>r._id===e);o>-1&&this.items.splice(o,1)}});else if(t){const e=t.findIndex(o=>o._id===a);e>-1&&t.splice(e,1)}else{const e=this.items.findIndex(o=>o._id===a);e>-1&&this.items.splice(e,1)}}catch(e){throw e}},clear(){this.$reset()}}}),yt={class:"mr-2"},Ft=Y({__name:"list",setup(a){const t=vt(),e=p({text:"",flag:1,page:1,rowsPerPage:15}),o=[{text:u("global.activite"),value:1},{text:u("global.inactivite"),value:0}],r=p([]),A=p([]),v=p(!1),I=p(!1),f=p(!1),m=p(!1),w=p(!1),b=async()=>{await ht(600),f.value&&(e.value.page=1,r.value=[],f.value=!1);const{data:c,rowsNumber:l}=await t.getItems(e.value);r.value=r.value.concat(c),e.value.page++,v.value=!1,(r.value.length>=l||!c.length)&&(I.value=!0)},T=async()=>{I.value=!1,v.value=!0,await b()},q=async()=>{f.value=!0,m.value=!1,await b()},B=async()=>{await t.setItem(),L.push("add")},U=async c=>{await t.setItem(c),L.push(`edit/${c._id}`)},C=async c=>{A.value=[st(c)],w.value=!0},D=async()=>{const c=await t.updateFlag(A.value.map(l=>({_id:l._id,flag:!e.value.flag})));c.status&&t.removeItems(c.success,r.value)},E=c=>{if(!c)return"";const l=[];for(const _ of c)l.push(_.name);return l.join(", ")};return(c,l)=>{const _=gt,J=ft,$=nt,O=mt,j=lt,G=pt,k=ot,H=dt,K=ct,M=ut,z=it,Q=Z,W=rt;return y(),N(V,null,[i(G,{modelValue:s(f),"onUpdate:modelValue":l[1]||(l[1]=n=>x(f)?f.value=n:null),"pulling-text":s(u)("global.textPulling"),"loosing-text":s(u)("global.textLoosing"),"loading-text":s(u)("global.textLoading"),onRefresh:T},{default:d(()=>[i(j,{loading:s(v),"onUpdate:loading":l[0]||(l[0]=n=>x(v)?v.value=n:null),finished:s(I),"finished-text":s(u)("global.textFinished"),"loading-text":s(u)("global.textLoading"),offset:50,onLoad:b},{default:d(()=>[(y(!0),N(V,null,tt(s(r),n=>(y(),S(O,{key:n._id},{left:d(()=>[i(_,{square:"",icon:"passed",type:"primary"})]),right:d(()=>[i(_,{square:"",icon:"edit",type:"success",onClick:F=>U(n)},null,8,["onClick"]),s(e).flag?(y(),S(_,{key:0,square:"",icon:"close",type:"danger",onClick:F=>C(n)},null,8,["onClick"])):(y(),S(_,{key:1,square:"",icon:"replay",type:"warning",onClick:F=>C(n)},null,8,["onClick"]))]),default:d(()=>[i($,{title:n.username,value:E(n.userRoles),label:n.fullName},{title:d(()=>[et("span",yt,P(n.username),1),i(J,{type:"primary"},{default:d(()=>[at(P(n.group),1)]),_:2},1024)]),_:2},1032,["title","value","label"])]),_:2},1024))),128))]),_:1},8,["loading","finished","finished-text","loading-text"])]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"]),i(_t,null,{item:d(()=>[i(k,{icon:"add-o",onClick:B}),i(k,{icon:"filter-o",onClick:l[2]||(l[2]=n=>m.value=!s(m))})]),_:1}),i(Q,{show:s(m),"onUpdate:show":l[5]||(l[5]=n=>x(m)?m.value=n:null),position:"bottom",style:{height:"30%"}},{default:d(()=>[i(H,{modelValue:s(e).text,"onUpdate:modelValue":l[3]||(l[3]=n=>s(e).text=n),placeholder:s(u)("global.search")},null,8,["modelValue","placeholder"]),i(z,null,{default:d(()=>[i($,{title:s(u)("global.status")},{value:d(()=>[i(M,null,{default:d(()=>[i(K,{modelValue:s(e).flag,"onUpdate:modelValue":l[4]||(l[4]=n=>s(e).flag=n),options:o,onChange:q},null,8,["modelValue"])]),_:1})]),_:1},8,["title"])]),_:1})]),_:1},8,["show"]),i(W,{show:s(w),"onUpdate:show":l[6]||(l[6]=n=>x(w)?w.value=n:null),"cancel-text":s(u)("global.cancel"),"close-on-click-action":"",actions:[{name:s(e).flag?s(u)("global.delete"):s(u)("global.recover"),color:s(e).flag?"#f56c6c":"#e6a23c"}],onSelect:D},null,8,["show","cancel-text","actions"])],64)}}});export{Ft as default};
